# hetu-cloud-proto-backend-spec 使用说明

这个 skill 干的事很直白：把“原始原型需求/PRD”从一坨能吵三天的描述，整理成后端能直接开工的《需求说明》。流程是两段式：先出《冲突说明（Q&A）》你来逐条拍板，再出最终《后端需求说明》。

## 你需要提供什么

最低配（必须）：

- 原始需求正文（txt/md，或直接粘贴）

推荐补齐（强烈建议，不然我只能猜）：

- 组织层级/权限模型（角色、数据范围、谁能改谁不能改）
- 存量约束（已有表结构/接口/枚举值，哪些必须兼容）
- 关键交互补充（如果原型图不方便发，就描述触发条件和边界）

## 怎么用（标准姿势）

### 第 1 步：让它先只输出冲突 Q&A

你可以直接这么说（把内容替换成你的原始需求）：

> 用 hetu-cloud-proto-backend-spec。下面是原始原型需求，请先生成《冲突说明（Q&A）》并按模板输出；不要生成最终后端需求说明，等我回答完再继续：  
> ……（粘贴原文）……

输出会是一份带 `Q1/Q2/...` 的 Markdown 文档，每个问题都留了 `你的回答` 空位。

### 第 2 步：你逐条回答

最省事的回答方式是：复制那份 Q&A 文档，把每个问题里的 `你的回答` 填上（或者用 “Q1：xxx” 的形式逐条回复）。

建议你在发回前做一次检查：全文搜索 `- 你的回答：`，确保没有“空答案”。没填的我会按 TBD 处理（或直接追问你补齐），不然最终文档口径还是会飘。

### 第 3 步：让它生成最终后端需求说明

你回答完后再说一句：

> 基于“原始需求 + 我刚才的回答”，生成最终《后端需求说明》，按模板输出，并把重难点单独拎出来讲清楚。

最终文档会偏后端视角：数据模型、枚举、状态流转、校验规则、权限/锁定、接口清单、边界与 out-of-scope 都会写清楚；并会增加一段 “冲突 Q&A 结论汇总（Decision Log）”，把 Q1/Q2/... 的最终口径压成可落地结论，方便实现与验收对齐。

### 用 txt 文件作为原始需求（推荐）

如果原始需求已经在一个 `txt` 文件里，不用把全文粘贴到对话里，直接告诉我文件路径即可（相对路径默认按当前对话的工作目录 `cwd` 解析）。

**阶段 1：只生成冲突说明（Q&A）并落盘**

> 用 hetu-cloud-proto-backend-spec。原始需求在 `./需求.txt`，请先读取该文件，只生成《冲突说明（Q&A）》并写入 `./out/需求-冲突说明-qa.md`（目录不存在就创建），不要生成最终后端需求说明。

**阶段 2：基于你的回答生成最终后端需求说明并落盘**

> 基于 `./需求.txt` + `./out/需求-冲突说明-qa.md`（我已填完回答），生成最终《后端需求说明》并写入 `./out/需求-后端需求说明.md`。

补充规则：

- 如果你不写“写入/落盘”，我默认只在对话里输出 Markdown。
- 如果目标文件已存在且你没说覆盖，我会先问你是否允许覆盖，避免误伤。

## 建议的产物命名

- `xxx-冲突说明-qa.md`
- `xxx-后端需求说明.md`

## 常见坑（提前打预防针）

- 只写“按钮能点/不能点”，不写“后端怎么校验/报什么错/谁有权限”——这就是冲突 Q&A 里最常见的问题源。
- 同一个概念换 3 个叫法（字段名、枚举名、页面文案各玩各的）——不统一就等着后端自爆。
- 没定义唯一性和幂等（重复提交、重复生成、重复关联）——线上事故最爱这种盲区。
- 回答里一句“前端处理/后端不用管”就想打发——可以，但你得把“后端到底做/不做什么”说成可落地结论（是否落库、是否校验、接口是否透传、默认兜底），否则等于没回答。
- 回答里一句“前端处理/后端不用管”就想打发——如果确实是 UI 纯交互/样式，那就老老实实标注 out-of-scope；但只要牵扯到接口/数据/校验/删除/验收口径，就得把“后端到底做/不做什么”说成可落地结论（是否落库、是否校验、接口是否透传、默认兜底），否则等于没回答。
